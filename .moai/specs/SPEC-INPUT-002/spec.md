---
id: "SPEC-INPUT-002"
version: "1.0.0"
status: "completed"
created: "2026-02-19"
updated: "2026-02-27"
author: "MoAI"
priority: "medium"
domain: "INPUT"
---

# SPEC-INPUT-002: 입력값 검증 강화 및 사용자 피드백 개선

## HISTORY

| 버전 | 날짜 | 변경사항 | 작성자 |
|------|------|----------|--------|
| 1.0.0 | 2026-02-19 | 초기 작성 | MoAI |

## 요약

사용자 입력값에 대한 선제적 검증을 강화하고, API 에러 코드에 따른 명확한 피드백 메시지를 제공합니다.

## 배경

현재 잘못된 입력값이 API 호출까지 전달되어 불필요한 요청이 발생하고 있으며, API 에러 코드("22", "30", "31")에 대한 사용자 친화적 메시지가 부족합니다.

## 이해관계자

- **최종 사용자**: 명확한 오류 메시지 기대
- **운영자**: 불필요한 API 호출 감소 필요

## 요구사항 (EARS)

### 환경 (Environment)

- 사용자 입력: 5자리 지역코드(LAWD_CD), YYYYMM 형식 날짜, 페이지 번호
- API 제약: 지역코드는 행정표준코드 관리시스템 기반, 날짜는 2006년 1월 이후만 조회 가능

### 가정 (Assumptions)

- 사용자는 API 제약사항을 미리 알지 못함
- 명확한 오류 메시지가 디버깅 시간을 단축함
- 선제적 검증이 API 호출 낭비를 줄임

### 요구사항 (Requirements)

#### REQ-IN-001: 지역코드 검증
**Event-Driven**: **WHEN** 사용자가 지역코드를 입력하면 **THEN** 시스템은 region_codes.txt 기반으로 유효성을 검증해야 한다.

#### REQ-IN-002: 날짜 형식 및 범위 검증
**Event-Driven**: **WHEN** 사용자가 날짜를 입력하면 **THEN** 시스템은 YYYYMM 형식과 조회 가능 기간(2006년 1월 ~ 현재)을 검증해야 한다.

#### REQ-IN-003: 일일 한도 초과 안내
**State-Driven**: **IF** API가 에러 코드 "22"(일일 한도 초과)를 반환하면 **THEN** 시스템은 남은 호출 가능 횟수와 재설정 시간을 사용자에게 안내해야 한다.

#### REQ-IN-004: 선제적 검증
**Unwanted**: 시스템은 잘못된 형식의 입력값에 대해 API 호출을 시도해서는 안 된다.

#### REQ-IN-005: 명확한 오류 메시지
**Event-Driven**: **WHEN** 입력 검증이 실패하면 **THEN** 시스템은 구체적인 오류 원인과 올바른 형식 예시를 제공해야 한다.

### 명세 (Specifications)

| 항목 | 값 |
|------|-----|
| 대상 파일 | `src/real_estate/mcp_server/tools/trade.py`, `rent.py`, `_helpers.py` |
| 검증 함수 | `validate_lawd_code()`, `validate_deal_ymd()`, `validate_pagination()` |
| 에러 코드 매핑 | API 에러 코드 22, 30, 31에 대한 사용자 친화적 메시지 |

## 비기능 요구사항

- **성능**: 검증은 10ms 이내에 완료되어야 함
- **사용자 경험**: 오류 메시지는 한국어로 제공

## 의존성

- `src/real_estate/resources/region_codes.txt`
- 기존 파서 모듈

## 위험 분석

| 위험 | 확률 | 영향 | 완화 전략 |
|------|------|------|----------|
| 지역코드 파일 변경 | 낮음 | 낮음 | 파일 감지 및 캐시 무효화 |
| 검증 로직 버그 | 낮음 | 중간 | 충분한 단위 테스트 |
